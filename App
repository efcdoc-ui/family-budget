<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>O'Connor Family Budget</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --ink: #0f1923;
    --ink2: #2a3a4a;
    --ink3: #5a6a7a;
    --paper: #f5f0e8;
    --paper2: #ede8dc;
    --paper3: #e0d9cc;
    --green: #2d6a4f;
    --green-l: #d8f3dc;
    --green-m: #74c69d;
    --red: #c1121f;
    --red-l: #fce4e4;
    --amber: #e76f00;
    --amber-l: #fff3e0;
    --blue: #1a4a8a;
    --blue-l: #e8f0fb;
    --accent: #c9a84c;
    --card: #ffffff;
    --shadow: 0 2px 12px rgba(15,25,35,0.08);
    --shadow-lg: 0 8px 32px rgba(15,25,35,0.12);
    --r: 14px;
  }

- { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

body {
font-family: â€˜DM Sansâ€™, sans-serif;
background: var(â€“paper);
color: var(â€“ink);
min-height: 100vh;
padding-bottom: 90px;
}

/* â”€â”€ HEADER â”€â”€ */
.header {
background: var(â€“ink);
padding: 20px 20px 0;
position: sticky;
top: 0;
z-index: 100;
}

.header-top {
display: flex;
align-items: center;
justify-content: space-between;
margin-bottom: 16px;
}

.logo {
font-family: â€˜DM Serif Displayâ€™, serif;
font-size: 22px;
color: var(â€“accent);
letter-spacing: -0.5px;
}

.month-select {
background: rgba(255,255,255,0.1);
border: 1px solid rgba(255,255,255,0.2);
color: white;
font-family: â€˜DM Sansâ€™, sans-serif;
font-size: 13px;
font-weight: 500;
padding: 6px 12px;
border-radius: 20px;
outline: none;
cursor: pointer;
}

.period-label {
font-size: 11px;
color: rgba(255,255,255,0.45);
margin-bottom: 10px;
margin-top: -10px;
letter-spacing: 0.3px;
}

.nav-tabs {
display: flex;
gap: 0;
overflow-x: auto;
scrollbar-width: none;
}
.nav-tabs::-webkit-scrollbar { display: none; }

.tab {
flex: 0 0 auto;
padding: 10px 18px;
font-size: 13px;
font-weight: 500;
color: rgba(255,255,255,0.5);
cursor: pointer;
border-bottom: 2px solid transparent;
transition: all 0.2s;
white-space: nowrap;
}

.tab.active {
color: var(â€“accent);
border-bottom-color: var(â€“accent);
}

/* â”€â”€ CONTENT â”€â”€ */
.content { padding: 16px; display: none; }
.content.active { display: block; }

/* â”€â”€ CARDS â”€â”€ */
.card {
background: var(â€“card);
border-radius: var(â€“r);
box-shadow: var(â€“shadow);
padding: 16px;
margin-bottom: 12px;
}

.card-title {
font-family: â€˜DM Serif Displayâ€™, serif;
font-size: 16px;
color: var(â€“ink);
margin-bottom: 12px;
display: flex;
align-items: center;
gap: 8px;
}

.card-title span { font-size: 18px; }

/* â”€â”€ SUMMARY STRIP â”€â”€ */
.summary-strip {
display: grid;
grid-template-columns: 1fr 1fr 1fr;
gap: 10px;
margin-bottom: 16px;
}

.summary-tile {
background: var(â€“card);
border-radius: var(â€“r);
padding: 14px 10px;
text-align: center;
box-shadow: var(â€“shadow);
}

.summary-tile .label {
font-size: 10px;
font-weight: 600;
text-transform: uppercase;
letter-spacing: 0.8px;
color: var(â€“ink3);
margin-bottom: 4px;
}

.summary-tile .amount {
font-family: â€˜DM Serif Displayâ€™, serif;
font-size: 18px;
font-weight: 400;
}

.tile-income .amount { color: var(â€“green); }
.tile-out .amount { color: var(â€“red); }
.tile-remaining .amount { color: var(â€“blue); }
.tile-remaining.positive .amount { color: var(â€“green); }
.tile-remaining.negative .amount { color: var(â€“red); }

/* â”€â”€ DD CHECKLIST â”€â”€ */
.dd-section-label {
font-size: 10px;
font-weight: 700;
text-transform: uppercase;
letter-spacing: 1px;
color: var(â€“ink3);
padding: 10px 0 6px;
}

.dd-item {
display: flex;
align-items: center;
gap: 12px;
padding: 11px 14px;
border-radius: 10px;
margin-bottom: 6px;
background: var(â€“paper);
transition: all 0.25s;
cursor: pointer;
border: 1.5px solid transparent;
}

.dd-item.confirmed {
background: var(â€“green-l);
border-color: var(â€“green-m);
}

.dd-item.issue {
background: var(â€“red-l);
border-color: var(â€“red);
}

.dd-check {
width: 26px;
height: 26px;
border-radius: 50%;
border: 2px solid var(â€“paper3);
display: flex;
align-items: center;
justify-content: center;
flex-shrink: 0;
font-size: 13px;
transition: all 0.2s;
background: white;
}

.dd-item.confirmed .dd-check {
background: var(â€“green);
border-color: var(â€“green);
color: white;
}

.dd-item.issue .dd-check {
background: var(â€“red);
border-color: var(â€“red);
color: white;
}

.dd-info { flex: 1; min-width: 0; }

.dd-name {
font-size: 14px;
font-weight: 500;
color: var(â€“ink);
white-space: nowrap;
overflow: hidden;
text-overflow: ellipsis;
}

.dd-item.confirmed .dd-name { color: var(â€“green); }

.dd-due {
font-size: 11px;
color: var(â€“ink3);
margin-top: 1px;
}

.dd-amount {
font-family: â€˜DM Serif Displayâ€™, serif;
font-size: 16px;
color: var(â€“ink);
flex-shrink: 0;
}

.dd-item.confirmed .dd-amount { color: var(â€“green); }

/* Long press menu */
.ctx-menu {
display: none;
position: fixed;
bottom: 100px;
left: 50%;
transform: translateX(-50%);
background: var(â€“ink);
border-radius: 14px;
padding: 6px;
z-index: 999;
box-shadow: var(â€“shadow-lg);
min-width: 200px;
}

.ctx-menu.show { display: block; }

.ctx-option {
display: flex;
align-items: center;
gap: 10px;
padding: 12px 16px;
color: white;
font-size: 14px;
font-weight: 500;
border-radius: 10px;
cursor: pointer;
transition: background 0.15s;
}

.ctx-option:hover { background: rgba(255,255,255,0.1); }
.ctx-option .icon { font-size: 18px; width: 24px; text-align: center; }
.ctx-option.green { color: var(â€“green-m); }
.ctx-option.red { color: #ff6b6b; }
.ctx-option.amber { color: var(â€“accent); }

.ctx-overlay {
display: none;
position: fixed;
inset: 0;
z-index: 998;
}
.ctx-overlay.show { display: block; }

/* â”€â”€ PROGRESS BAR â”€â”€ */
.progress-wrap { margin-top: 8px; }

.progress-bar-bg {
height: 8px;
background: var(â€“paper2);
border-radius: 4px;
overflow: hidden;
}

.progress-bar-fill {
height: 100%;
border-radius: 4px;
transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
background: var(â€“green);
}

.progress-label {
display: flex;
justify-content: space-between;
font-size: 11px;
color: var(â€“ink3);
margin-top: 4px;
}

/* â”€â”€ VARIABLE SPEND â”€â”€ */
.var-item {
display: flex;
align-items: center;
gap: 10px;
padding: 10px 0;
border-bottom: 1px solid var(â€“paper2);
}

.var-item:last-child { border-bottom: none; }

.var-emoji { font-size: 20px; width: 32px; text-align: center; flex-shrink: 0; }

.var-info { flex: 1; }

.var-name { font-size: 14px; font-weight: 500; }

.var-budget { font-size: 11px; color: var(â€“ink3); margin-top: 1px; }

.var-input-wrap { display: flex; flex-direction: column; align-items: flex-end; gap: 2px; }

.var-input {
width: 90px;
text-align: right;
border: 1.5px solid var(â€“paper3);
border-radius: 8px;
padding: 6px 10px;
font-family: â€˜DM Serif Displayâ€™, serif;
font-size: 16px;
color: var(â€“ink);
background: var(â€“paper);
outline: none;
transition: border-color 0.2s;
}

.var-input:focus { border-color: var(â€“blue); background: white; }

.var-diff {
font-size: 11px;
font-weight: 600;
}

.var-diff.over { color: var(â€“red); }
.var-diff.under { color: var(â€“green); }

/* â”€â”€ DEBT TRACKER â”€â”€ */
.debt-total-hero {
background: linear-gradient(135deg, var(â€“ink) 0%, var(â€“ink2) 100%);
border-radius: var(â€“r);
padding: 20px;
margin-bottom: 12px;
position: relative;
overflow: hidden;
}

.debt-total-hero::before {
content: â€˜â€™;
position: absolute;
right: -20px;
top: -20px;
width: 100px;
height: 100px;
border-radius: 50%;
background: rgba(201,168,76,0.15);
}

.debt-hero-label {
font-size: 11px;
font-weight: 600;
text-transform: uppercase;
letter-spacing: 1px;
color: rgba(255,255,255,0.5);
margin-bottom: 4px;
}

.debt-hero-amount {
font-family: â€˜DM Serif Displayâ€™, serif;
font-size: 38px;
color: white;
letter-spacing: -1px;
}

.debt-hero-sub {
font-size: 12px;
color: rgba(255,255,255,0.5);
margin-top: 6px;
}

.debt-hero-sub strong {
color: var(â€“green-m);
}

.debt-monthly-grid {
display: grid;
grid-template-columns: repeat(6, 1fr);
gap: 4px;
margin-top: 14px;
}

.debt-month-dot {
background: rgba(255,255,255,0.1);
border-radius: 6px;
padding: 5px 2px;
text-align: center;
}

.debt-month-dot.has-data {
background: rgba(116,198,157,0.25);
}

.debt-month-dot .dot-label {
font-size: 9px;
color: rgba(255,255,255,0.5);
font-weight: 600;
}

.debt-month-dot .dot-val {
font-size: 10px;
color: var(â€“green-m);
font-weight: 600;
margin-top: 2px;
}

.debt-item {
display: flex;
align-items: center;
padding: 12px 0;
border-bottom: 1px solid var(â€“paper2);
gap: 12px;
}

.debt-item:last-child { border-bottom: none; }

.debt-item-info { flex: 1; }

.debt-item-name { font-size: 14px; font-weight: 500; }

.debt-item-balance { font-size: 11px; color: var(â€“ink3); margin-top: 2px; }

.debt-item-input {
width: 100px;
text-align: right;
border: 1.5px solid var(â€“paper3);
border-radius: 8px;
padding: 6px 10px;
font-family: â€˜DM Serif Displayâ€™, serif;
font-size: 15px;
color: var(â€“ink);
background: var(â€“paper);
outline: none;
transition: border-color 0.2s;
}

.debt-item-input:focus { border-color: var(â€“blue); background: white; }

/* â”€â”€ BOTTOM NAV â”€â”€ */
.bottom-nav {
position: fixed;
bottom: 0;
left: 0;
right: 0;
background: white;
border-top: 1px solid var(â€“paper2);
display: flex;
padding: 8px 0 20px;
z-index: 100;
box-shadow: 0 -4px 20px rgba(15,25,35,0.08);
}

.nav-btn {
flex: 1;
display: flex;
flex-direction: column;
align-items: center;
gap: 3px;
padding: 6px 0;
cursor: pointer;
color: var(â€“ink3);
transition: color 0.2s;
font-size: 10px;
font-weight: 600;
text-transform: uppercase;
letter-spacing: 0.5px;
}

.nav-btn .nav-icon { font-size: 22px; }
.nav-btn.active { color: var(â€“blue); }

/* â”€â”€ TOAST â”€â”€ */
.toast {
position: fixed;
top: -60px;
left: 50%;
transform: translateX(-50%);
background: var(â€“ink);
color: white;
padding: 10px 20px;
border-radius: 20px;
font-size: 13px;
font-weight: 500;
transition: top 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
z-index: 9999;
white-space: nowrap;
}

.toast.show { top: 80px; }

/* â”€â”€ MISC â”€â”€ */
.section-divider {
display: flex;
align-items: center;
gap: 8px;
margin: 16px 0 8px;
}

.section-divider-line { flex: 1; height: 1px; background: var(â€“paper2); }

.section-divider-label {
font-size: 10px;
font-weight: 700;
text-transform: uppercase;
letter-spacing: 1px;
color: var(â€“ink3);
}

.badge {
display: inline-flex;
align-items: center;
justify-content: center;
background: var(â€“green);
color: white;
font-size: 10px;
font-weight: 700;
width: 18px;
height: 18px;
border-radius: 50%;
margin-left: auto;
}

.badge.amber { background: var(â€“amber); }

.all-done-banner {
background: linear-gradient(135deg, var(â€“green) 0%, #40916c 100%);
border-radius: var(â€“r);
padding: 16px;
color: white;
text-align: center;
margin-bottom: 12px;
}

.all-done-banner .big { font-family: â€˜DM Serif Displayâ€™, serif; font-size: 22px; }
.all-done-banner .sub { font-size: 12px; opacity: 0.8; margin-top: 4px; }

/* â”€â”€ EDIT MODAL â”€â”€ */
.modal-overlay {
display: none;
position: fixed;
inset: 0;
background: rgba(15,25,35,0.6);
z-index: 500;
backdrop-filter: blur(2px);
}
.modal-overlay.show { display: flex; align-items: flex-end; }

.modal {
background: white;
border-radius: 20px 20px 0 0;
padding: 24px 20px 40px;
width: 100%;
transform: translateY(100%);
transition: transform 0.3s cubic-bezier(0.34,1.2,0.64,1);
}
.modal-overlay.show .modal { transform: translateY(0); }

.modal-handle {
width: 36px;
height: 4px;
background: var(â€“paper3);
border-radius: 2px;
margin: 0 auto 20px;
}

.modal-title {
font-family: â€˜DM Serif Displayâ€™, serif;
font-size: 20px;
margin-bottom: 16px;
}

.modal-field { margin-bottom: 14px; }

.modal-label {
font-size: 11px;
font-weight: 700;
text-transform: uppercase;
letter-spacing: 0.8px;
color: var(â€“ink3);
margin-bottom: 6px;
}

.modal-input {
width: 100%;
padding: 12px 14px;
border: 1.5px solid var(â€“paper3);
border-radius: 10px;
font-family: â€˜DM Sansâ€™, sans-serif;
font-size: 16px;
color: var(â€“ink);
background: var(â€“paper);
outline: none;
transition: border-color 0.2s;
}
.modal-input:focus { border-color: var(â€“blue); background: white; }

.modal-btn {
width: 100%;
padding: 14px;
border: none;
border-radius: 12px;
font-family: â€˜DM Sansâ€™, sans-serif;
font-size: 15px;
font-weight: 600;
cursor: pointer;
margin-top: 6px;
transition: opacity 0.15s;
}
.modal-btn:active { opacity: 0.8; }
.modal-btn-primary { background: var(â€“ink); color: white; }
.modal-btn-danger  { background: var(â€“red-l); color: var(â€“red); margin-top: 8px; }
.modal-btn-cancel  { background: var(â€“paper2); color: var(â€“ink3); margin-top: 8px; }

/* â”€â”€ ADD DD BUTTON â”€â”€ */
.add-dd-btn {
display: flex;
align-items: center;
justify-content: center;
gap: 8px;
width: 100%;
padding: 12px;
margin-top: 8px;
background: var(â€“blue-l);
border: 1.5px dashed var(â€“blue);
border-radius: 10px;
color: var(â€“blue);
font-size: 14px;
font-weight: 600;
cursor: pointer;
transition: background 0.15s;
}
.add-dd-btn:active { background: #d0e4f7; }

/* edit pencil on DD amount */
.dd-amount-wrap {
display: flex;
flex-direction: column;
align-items: flex-end;
flex-shrink: 0;
}
.dd-edit-hint {
font-size: 9px;
color: var(â€“ink3);
margin-top: 2px;
opacity: 0.7;
}

</style>
</head>
<body>

<div class="header">
  <div class="header-top">
    <div class="logo">O'Connor Budget</div>
    <select class="month-select" id="monthSelect" onchange="changeMonth(this.value)">
      <option value="0">24 Jan â€“ 23 Feb</option>
      <option value="1">24 Feb â€“ 23 Mar</option>
      <option value="2">24 Mar â€“ 23 Apr</option>
      <option value="3">24 Apr â€“ 23 May</option>
      <option value="4">24 May â€“ 23 Jun</option>
      <option value="5">24 Jun â€“ 23 Jul</option>
      <option value="6">24 Jul â€“ 23 Aug</option>
      <option value="7">24 Aug â€“ 23 Sep</option>
      <option value="8">24 Sep â€“ 23 Oct</option>
      <option value="9">24 Oct â€“ 23 Nov</option>
      <option value="10">24 Nov â€“ 23 Dec</option>
      <option value="11">24 Dec â€“ 23 Jan</option>
    </select>
  </div>
  <div class="nav-tabs">
    <div class="tab active" onclick="showTab('overview')">Overview</div>
    <div class="tab" onclick="showTab('checklist')">Direct Debits</div>
    <div class="tab" onclick="showTab('variable')">Variable</div>
    <div class="tab" onclick="showTab('debt')">Debt</div>
  </div>
  <div class="period-label" id="periodLabel"></div>
</div>

<!-- CONTEXT MENU -->

<div class="ctx-overlay" id="ctxOverlay" onclick="closeCtxMenu()"></div>
<div class="ctx-menu" id="ctxMenu">
  <div class="ctx-option green" onclick="setDDStatus('confirmed')">
    <span class="icon">âœ“</span> Confirmed out
  </div>
  <div class="ctx-option amber" onclick="setDDStatus('check')">
    <span class="icon">?</span> Need to check
  </div>
  <div class="ctx-option red" onclick="setDDStatus('issue')">
    <span class="icon">âœ—</span> Issue / problem
  </div>
  <div class="ctx-option" onclick="openEditModal(ctxId); closeCtxMenu();">
    <span class="icon">âœï¸</span> Edit amount / name
  </div>
  <div class="ctx-option red" onclick="deleteDD(ctxId); closeCtxMenu();" id="ctx-delete-btn">
    <span class="icon">ğŸ—‘</span> Delete
  </div>
  <div class="ctx-option" onclick="setDDStatus('')">
    <span class="icon">â—‹</span> Reset status
  </div>
</div>

<!-- EDIT DD MODAL -->

<div class="modal-overlay" id="editModal" onclick="closeEditModal(event)">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title" id="editModalTitle">Edit Direct Debit</div>
    <div class="modal-field">
      <div class="modal-label">Name</div>
      <input class="modal-input" id="editName" type="text" placeholder="e.g. Car Loan">
    </div>
    <div class="modal-field">
      <div class="modal-label">Amount Â£</div>
      <input class="modal-input" id="editAmount" type="number" inputmode="decimal" placeholder="0.00">
    </div>
    <div class="modal-field">
      <div class="modal-label">Due date (approx)</div>
      <input class="modal-input" id="editDue" type="text" placeholder="e.g. 1st, 15th">
    </div>
    <div class="modal-field">
      <div class="modal-label">Section</div>
      <select class="modal-input" id="editSection">
        <option>Home</option>
        <option>Transport</option>
        <option>Insurance</option>
        <option>Debt</option>
        <option>Savings</option>
        <option>Other</option>
      </select>
    </div>
    <button class="modal-btn modal-btn-primary" onclick="saveEditModal()">Save changes</button>
    <button class="modal-btn modal-btn-cancel" onclick="closeEditModal()">Cancel</button>
  </div>
</div>

<!-- ADD DD MODAL -->

<div class="modal-overlay" id="addModal" onclick="closeAddModal(event)">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">Add Direct Debit</div>
    <div class="modal-field">
      <div class="modal-label">Name</div>
      <input class="modal-input" id="addName" type="text" placeholder="e.g. Netflix">
    </div>
    <div class="modal-field">
      <div class="modal-label">Amount Â£</div>
      <input class="modal-input" id="addAmount" type="number" inputmode="decimal" placeholder="0.00">
    </div>
    <div class="modal-field">
      <div class="modal-label">Due date (approx)</div>
      <input class="modal-input" id="addDue" type="text" placeholder="e.g. 1st, 15th">
    </div>
    <div class="modal-field">
      <div class="modal-label">Section</div>
      <select class="modal-input" id="addSection">
        <option>Home</option>
        <option>Transport</option>
        <option>Insurance</option>
        <option>Debt</option>
        <option>Savings</option>
        <option>Other</option>
      </select>
    </div>
    <button class="modal-btn modal-btn-primary" onclick="saveAddModal()">Add payment</button>
    <button class="modal-btn modal-btn-cancel" onclick="closeAddModal()">Cancel</button>
  </div>
</div>

<!-- TOAST -->

<div class="toast" id="toast"></div>

<!-- â”€â”€ OVERVIEW TAB â”€â”€ -->

<div class="content active" id="tab-overview">

  <div class="summary-strip">
    <div class="summary-tile tile-income">
      <div class="label">Income</div>
      <div class="amount" id="ov-income">Â£5,583</div>
    </div>
    <div class="summary-tile tile-out">
      <div class="label">Out</div>
      <div class="amount" id="ov-out">â€”</div>
    </div>
    <div class="summary-tile tile-remaining" id="ov-remaining-tile">
      <div class="label">Left</div>
      <div class="amount" id="ov-remaining">â€”</div>
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span>ğŸ“‹</span> Direct Debits</div>
    <div class="progress-wrap">
      <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:6px;">
        <span id="ov-dd-count" style="color:var(--ink3)">0 of 0 confirmed</span>
        <span id="ov-dd-amount" style="font-weight:600;color:var(--green)">Â£0</span>
      </div>
      <div class="progress-bar-bg">
        <div class="progress-bar-fill" id="ov-dd-bar" style="width:0%"></div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-title"><span>ğŸ›’</span> Variable Spend</div>
    <div id="ov-variable-list"></div>
  </div>

  <div class="card">
    <div class="card-title"><span>ğŸ’³</span> Debt Progress</div>
    <div style="display:flex;justify-content:space-between;align-items:baseline;margin-bottom:8px;">
      <span style="font-size:13px;color:var(--ink3)">Total remaining</span>
      <span style="font-family:'DM Serif Display',serif;font-size:22px;" id="ov-debt-total">Â£20,000</span>
    </div>
    <div class="progress-wrap">
      <div class="progress-bar-bg">
        <div class="progress-bar-fill" id="ov-debt-bar" style="width:0%;background:var(--accent)"></div>
      </div>
      <div class="progress-label">
        <span id="ov-debt-paid">Â£0 paid</span>
        <span>Â£21,884 start</span>
      </div>
    </div>
    <div style="margin-top:10px;font-size:12px;color:var(--ink3)" id="ov-debt-eta"></div>
  </div>

</div>

<!-- â”€â”€ CHECKLIST TAB â”€â”€ -->

<div class="content" id="tab-checklist">
  <div id="checklist-all-done" style="display:none">
    <div class="all-done-banner">
      <div class="big">ğŸ‰ All done!</div>
      <div class="sub">Every direct debit confirmed this month</div>
    </div>
  </div>
  <div id="checklist-body"></div>
</div>

<!-- â”€â”€ VARIABLE TAB â”€â”€ -->

<div class="content" id="tab-variable">
  <div class="card">
    <div class="card-title"><span>ğŸ›’</span> Variable Spend</div>
    <div id="var-items-list"></div>
    <div style="border-top:2px solid var(--paper2);margin-top:12px;padding-top:12px;display:flex;justify-content:space-between;align-items:center;">
      <span style="font-size:13px;font-weight:600;">Total</span>
      <div style="text-align:right;">
        <div style="font-family:'DM Serif Display',serif;font-size:20px;" id="var-total-actual">Â£0</div>
        <div style="font-size:11px;color:var(--ink3)">Budget: <span id="var-total-budget">Â£1,165</span></div>
      </div>
    </div>
  </div>
</div>

<!-- â”€â”€ DEBT TAB â”€â”€ -->

<div class="content" id="tab-debt">

  <div class="debt-total-hero">
    <div class="debt-hero-label">Total Debt Remaining</div>
    <div class="debt-hero-amount" id="debt-hero-amount">Â£20,000</div>
    <div class="debt-hero-sub">Paying approx. <strong>Â£1,000/month</strong> Â· <span id="debt-eta-hero">~20 months to clear</span></div>
    <div class="debt-monthly-grid" id="debt-monthly-grid"></div>
  </div>

  <div class="card">
    <div class="card-title"><span>ğŸ“</span> Update balances</div>
    <div style="font-size:12px;color:var(--ink3);margin-bottom:12px;">Enter current balance for each debt. Tap a field to update.</div>
    <div id="debt-items-list"></div>
  </div>

</div>

<script>
// â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const MONTHS = ['January','February','March','April','May','June',
                'July','August','September','October','November','December'];
const SHORT_MONTHS = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];

// Period labels: period index N = "24 MONTHS[N] â€“ 23 MONTHS[N+1]"
const PERIOD_LABELS = [
  '24 Jan â€“ 23 Feb', '24 Feb â€“ 23 Mar', '24 Mar â€“ 23 Apr',
  '24 Apr â€“ 23 May', '24 May â€“ 23 Jun', '24 Jun â€“ 23 Jul',
  '24 Jul â€“ 23 Aug', '24 Aug â€“ 23 Sep', '24 Sep â€“ 23 Oct',
  '24 Oct â€“ 23 Nov', '24 Nov â€“ 23 Dec', '24 Dec â€“ 23 Jan'
];

// Current period: if today >= 24th, period = this month; else period = previous month
function getCurrentPeriod() {
  const now = new Date();
  const day = now.getDate();
  const m = now.getMonth(); // 0=Jan
  return day >= 24 ? m : (m === 0 ? 11 : m - 1);
}

function getPeriodDates(periodIdx) {
  // Period N starts 24th of month N, ends 23rd of month N+1
  const startMonth = MONTHS[periodIdx];
  const endMonthIdx = (periodIdx + 1) % 12;
  const endMonth = MONTHS[endMonthIdx];
  return `24 ${startMonth} â€“ 23 ${endMonth}`;
}

const INCOME = 5583;

const DD_LIST = [
  { id: 'mortgage',    name: 'Mortgage / Rent',       amount: 812.37, due: '1st',  section: 'Home' },
  { id: 'council',     name: 'Council Tax',            amount: 185.00, due: '1st',  section: 'Home' },
  { id: 'electricity', name: 'Electricity',            amount: 104.00, due: '3rd',  section: 'Home' },
  { id: 'gas',         name: 'Gas / Oil',              amount: 104.00, due: '3rd',  section: 'Home' },
  { id: 'water',       name: 'Water',                  amount:  95.00, due: '5th',  section: 'Home' },
  { id: 'internet',    name: 'Internet',               amount:  30.00, due: '5th',  section: 'Home' },
  { id: 'phone',       name: 'Phone',                  amount:  21.00, due: '7th',  section: 'Home' },
  { id: 'tvlicence',   name: 'TV Licence',             amount:  15.00, due: '7th',  section: 'Home' },
  { id: 'homeins',     name: 'Home Insurance',         amount:  20.00, due: '8th',  section: 'Home' },
  { id: 'carpay',      name: 'Car Payment',            amount: 380.00, due: '1st',  section: 'Transport' },
  { id: 'autoins',     name: 'Auto Insurance',         amount:  59.00, due: '10th', section: 'Transport' },
  { id: 'gapins',      name: 'Gap Insurance',          amount:  14.14, due: '10th', section: 'Transport' },
  { id: 'lifeins',     name: 'Life Insurance',         amount:   9.89, due: '12th', section: 'Insurance' },
  { id: 'healthins',   name: 'Health Insurance',       amount:  20.00, due: '12th', section: 'Insurance' },
  { id: 'union',       name: 'Union',                  amount:   4.24, due: '15th', section: 'Other' },
  { id: 'kidsclubs',   name: 'Kids Clubs',             amount:  25.00, due: '15th', section: 'Other' },
  { id: 'nursery',     name: 'Nursery',                amount: 130.00, due: '15th', section: 'Other' },
  { id: 'barclaycard', name: 'Barclaycard (min)',      amount: 150.00, due: '18th', section: 'Debt' },
  { id: 'hsbc',        name: 'HSBC (min)',             amount: 407.82, due: '18th', section: 'Debt' },
  { id: 'paypal',      name: 'PayPal (min)',           amount: 100.00, due: '20th', section: 'Debt' },
  { id: 'lloyds',      name: 'Lloyds (min)',           amount: 313.86, due: '20th', section: 'Debt' },
  { id: 'extradebt',   name: 'Additional Debt',        amount:  28.32, due: '22nd', section: 'Debt' },
  { id: 'carloan',     name: 'Car Loan',               amount: 270.00, due: '1st',  section: 'Transport' },
  { id: 'savings',     name: 'Savings Transfer',       amount: 100.00, due: '25th', section: 'Savings' },
];

const VAR_LIST = [
  { id: 'groceries', name: 'Groceries', emoji: 'ğŸ›’', budget: 800 },
  { id: 'fuel',      name: 'Fuel',      emoji: 'â›½', budget: 123 },
  { id: 'tunnel',    name: 'Tunnel',    emoji: 'ğŸš—', budget:  10 },
  { id: 'vet',       name: 'Vet / Pet', emoji: 'ğŸ¾', budget:  31 },
  { id: 'medicine',  name: 'Medicine',  emoji: 'ğŸ’Š', budget:  11 },
  { id: 'other',     name: 'Other',     emoji: 'ğŸ“¦', budget:   0 },
];

const DEBT_LIST = [
  { id: 'debt_barclaycard', name: 'Barclaycard', opening: 10700 },
  { id: 'debt_amex',        name: 'Amex',         opening:  4750 },
  { id: 'debt_halifax',     name: 'Halifax',      opening:  9118.56 },
  { id: 'debt_paypal',      name: 'PayPal',       opening:  2080.47 },
  { id: 'debt_overdraft',   name: 'Dan Overdraft',opening:  2300 },
  { id: 'debt_school',      name: 'School Fees',  opening:   600 },
  { id: 'debt_very',        name: 'Very',         opening:   253.98 },
  { id: 'debt_hsbc',        name: 'HSBC',         opening:     0 },
  { id: 'debt_lloyds',      name: 'Lloyds',       opening:     0 },
];

const DEBT_START = 21884.45;

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentMonth = getCurrentPeriod();
let activeTab = 'overview';
let ctxTarget = null;

// Storage helpers
function getKey(suffix) { return `ocb_${currentMonth}_${suffix}`; }

function load(key, def) {
  try {
    const v = localStorage.getItem(key);
    return v !== null ? JSON.parse(v) : def;
  } catch(e) { return def; }
}

function save(key, val) {
  try { localStorage.setItem(key, JSON.stringify(val)); } catch(e) {}
}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('monthSelect').value = currentMonth;

function updatePeriodLabel() {
  document.getElementById('periodLabel').textContent = getPeriodDates(currentMonth);
  document.getElementById('monthSelect').value = currentMonth;
}

function init() {
  updatePeriodLabel();
  renderChecklist();
  renderVariable();
  renderDebt();
  renderOverview();
}

// â”€â”€ TAB SWITCHING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showTab(tab) {
  activeTab = tab;
  document.querySelectorAll('.content').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
  document.getElementById('tab-' + tab).classList.add('active');
  document.querySelectorAll('.tab').forEach(el => {
    if (el.textContent.toLowerCase().includes(tab === 'checklist' ? 'direct' : tab === 'variable' ? 'variable' : tab === 'debt' ? 'debt' : 'overview')) {
      el.classList.add('active');
    }
  });
  // Fix active tab by index
  const tabMap = { overview: 0, checklist: 1, variable: 2, debt: 3 };
  document.querySelectorAll('.tab')[tabMap[tab]].classList.add('active');
}

function changeMonth(val) {
  currentMonth = parseInt(val);
  init();
}

// â”€â”€ CHECKLIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getAllDD() {
  // Merge base DD_LIST with any custom ones saved in storage
  const custom = load('ocb_custom_dd', []);
  return [...DD_LIST, ...custom];
}

function renderChecklist() {
  const statuses   = load(getKey('dd'), {});
  const overrides  = load(getKey('dd_amounts'), {});  // per-period amount overrides
  const allDD      = getAllDD();
  const body       = document.getElementById('checklist-body');
  const sections   = [...new Set(allDD.map(d => d.section))];

  let html = '';
  sections.forEach(sec => {
    const items = allDD.filter(d => d.section === sec);
    html += `<div class="dd-section-label">${sec}</div>`;
    items.forEach(dd => {
      const status  = statuses[dd.id] || '';
      const amount  = overrides[dd.id] !== undefined ? overrides[dd.id] : dd.amount;
      const cls     = status === 'confirmed' ? 'confirmed' : status === 'issue' ? 'issue' : '';
      const chk     = status === 'confirmed' ? 'âœ“' : status === 'issue' ? 'âœ—' : status === 'check' ? '?' : '';
      html += `
        <div class="dd-item ${cls}" id="dd-${dd.id}"
             onclick="tapDD('${dd.id}')"
             oncontextmenu="openCtxMenu(event,'${dd.id}'); return false;">
          <div class="dd-check">${chk}</div>
          <div class="dd-info">
            <div class="dd-name">${dd.name}</div>
            <div class="dd-due">Due ~${dd.due}</div>
          </div>
          <div class="dd-amount-wrap">
            <div class="dd-amount">Â£${parseFloat(amount).toFixed(2)}</div>
            <div class="dd-edit-hint">hold to edit</div>
          </div>
        </div>`;
    });
  });

  html += `<div class="add-dd-btn" onclick="openAddModal()">ï¼‹ Add a payment</div>`;
  body.innerHTML = html;

  const total     = allDD.length;
  const confirmed = allDD.filter(d => (statuses[d.id] || '') === 'confirmed').length;
  document.getElementById('checklist-all-done').style.display = confirmed === total ? 'block' : 'none';
  updateOverviewDD(statuses);
}

function tapDD(id) {
  const statuses = load(getKey('dd'), {});
  const current  = statuses[id] || '';
  statuses[id]   = current === 'confirmed' ? '' : 'confirmed';
  save(getKey('dd'), statuses);
  renderChecklist();
  renderOverview();
  if (statuses[id] === 'confirmed') showToast('âœ“ Confirmed');
}

let ctxId = null;
function openCtxMenu(e, id) {
  e.preventDefault();
  ctxId = id;
  // Show delete only for custom DDs
  const isCustom = load('ocb_custom_dd', []).some(d => d.id === id);
  document.getElementById('ctx-delete-btn').style.display = isCustom ? 'flex' : 'none';
  document.getElementById('ctxMenu').classList.add('show');
  document.getElementById('ctxOverlay').classList.add('show');
}

function closeCtxMenu() {
  document.getElementById('ctxMenu').classList.remove('show');
  document.getElementById('ctxOverlay').classList.remove('show');
  ctxId = null;
}

function setDDStatus(status) {
  if (!ctxId) return;
  const statuses  = load(getKey('dd'), {});
  statuses[ctxId] = status;
  save(getKey('dd'), statuses);
  closeCtxMenu();
  renderChecklist();
  renderOverview();
  const labels = { confirmed: 'âœ“ Confirmed', check: '? Flagged to check', issue: 'âœ— Issue flagged', '': 'Reset' };
  showToast(labels[status] || 'Updated');
}

// â”€â”€ EDIT MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let editingId = null;

function openEditModal(id) {
  editingId = id;
  const allDD     = getAllDD();
  const dd        = allDD.find(d => d.id === id);
  const overrides = load(getKey('dd_amounts'), {});
  const amount    = overrides[id] !== undefined ? overrides[id] : (dd ? dd.amount : '');

  document.getElementById('editModalTitle').textContent = `Edit: ${dd ? dd.name : ''}`;
  document.getElementById('editName').value   = dd ? dd.name : '';
  document.getElementById('editAmount').value = amount;
  document.getElementById('editDue').value    = dd ? dd.due : '';
  document.getElementById('editSection').value = dd ? dd.section : 'Other';
  document.getElementById('editModal').classList.add('show');
}

function closeEditModal(e) {
  if (e && e.target !== document.getElementById('editModal')) return;
  document.getElementById('editModal').classList.remove('show');
  editingId = null;
}

function saveEditModal() {
  if (!editingId) return;
  const name    = document.getElementById('editName').value.trim();
  const amount  = parseFloat(document.getElementById('editAmount').value) || 0;
  const due     = document.getElementById('editDue').value.trim();
  const section = document.getElementById('editSection').value;

  // Save amount override for this period
  const overrides   = load(getKey('dd_amounts'), {});
  overrides[editingId] = amount;
  save(getKey('dd_amounts'), overrides);

  // If it's a custom DD, also update the base record
  const custom = load('ocb_custom_dd', []);
  const idx    = custom.findIndex(d => d.id === editingId);
  if (idx !== -1) {
    custom[idx] = { ...custom[idx], name, amount, due, section };
    save('ocb_custom_dd', custom);
  }

  document.getElementById('editModal').classList.remove('show');
  editingId = null;
  renderChecklist();
  renderOverview();
  showToast('âœ“ Updated');
}

function deleteDD(id) {
  const custom = load('ocb_custom_dd', []);
  const updated = custom.filter(d => d.id !== id);
  save('ocb_custom_dd', updated);
  renderChecklist();
  renderOverview();
  showToast('Deleted');
}

// â”€â”€ ADD MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openAddModal() {
  document.getElementById('addName').value   = '';
  document.getElementById('addAmount').value = '';
  document.getElementById('addDue').value    = '';
  document.getElementById('addSection').value = 'Other';
  document.getElementById('addModal').classList.add('show');
}

function closeAddModal(e) {
  if (e && e.target !== document.getElementById('addModal')) return;
  document.getElementById('addModal').classList.remove('show');
}

function saveAddModal() {
  const name    = document.getElementById('addName').value.trim();
  const amount  = parseFloat(document.getElementById('addAmount').value) || 0;
  const due     = document.getElementById('addDue').value.trim() || 'â€”';
  const section = document.getElementById('addSection').value;

  if (!name) { showToast('Please enter a name'); return; }

  const id     = 'custom_' + Date.now();
  const custom = load('ocb_custom_dd', []);
  custom.push({ id, name, amount, due, section });
  save('ocb_custom_dd', custom);

  document.getElementById('addModal').classList.remove('show');
  renderChecklist();
  renderOverview();
  showToast('âœ“ Payment added');
}

// â”€â”€ VARIABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderVariable() {
  const actuals = load(getKey('var'), {});
  let html = '';
  let totalActual = 0, totalBudget = 0;

  VAR_LIST.forEach(v => {
    const actual = actuals[v.id] !== undefined ? actuals[v.id] : '';
    const diff = actual !== '' ? v.budget - parseFloat(actual) : null;
    totalBudget += v.budget;
    if (actual !== '') totalActual += parseFloat(actual);

    let diffHtml = '';
    if (diff !== null) {
      const cls = diff < 0 ? 'over' : 'under';
      const sign = diff < 0 ? '-' : '+';
      diffHtml = `<div class="var-diff ${cls}">${sign}Â£${Math.abs(diff).toFixed(0)}</div>`;
    }

    html += `
      <div class="var-item">
        <div class="var-emoji">${v.emoji}</div>
        <div class="var-info">
          <div class="var-name">${v.name}</div>
          <div class="var-budget">Budget: Â£${v.budget}</div>
        </div>
        <div class="var-input-wrap">
          <input class="var-input" type="number" inputmode="decimal" placeholder="Â£0"
                 value="${actual}" 
                 onchange="saveVar('${v.id}', this.value)"
                 onblur="saveVar('${v.id}', this.value)">
          ${diffHtml}
        </div>
      </div>`;
  });

  document.getElementById('var-items-list').innerHTML = html;
  document.getElementById('var-total-actual').textContent = totalActual > 0 ? `Â£${totalActual.toFixed(0)}` : 'â€”';
  document.getElementById('var-total-budget').textContent = `Â£${totalBudget}`;

  updateOverviewVariable(actuals);
}

function saveVar(id, val) {
  const actuals = load(getKey('var'), {});
  actuals[id] = val === '' ? '' : parseFloat(val) || 0;
  save(getKey('var'), actuals);
  renderVariable();
  renderOverview();
}

// â”€â”€ DEBT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderDebt() {
  // Build monthly totals across all months
  const monthlyTotals = [];
  for (let m = 0; m < 12; m++) {
    const balances = load(`ocb_${m}_debt`, {});
    if (Object.keys(balances).length > 0) {
      const total = DEBT_LIST.reduce((sum, d) => {
        const v = balances[d.id];
        return sum + (v !== undefined && v !== '' ? parseFloat(v) : d.opening);
      }, 0);
      monthlyTotals[m] = total;
    }
  }

  // Current month balances
  const balances = load(getKey('debt'), {});
  const currentTotal = DEBT_LIST.reduce((sum, d) => {
    const v = balances[d.id];
    return sum + (v !== undefined && v !== '' ? parseFloat(v) : d.opening);
  }, 0);

  // Hero
  document.getElementById('debt-hero-amount').textContent = `Â£${currentTotal.toLocaleString('en-GB', {minimumFractionDigits: 0, maximumFractionDigits: 0})}`;

  // ETA
  const monthlyPay = 1000;
  const monthsLeft = Math.ceil(currentTotal / monthlyPay);
  document.getElementById('debt-eta-hero').textContent = `~${monthsLeft} months to clear`;

  // Monthly grid
  let gridHtml = '';
  for (let m = 0; m < 12; m++) {
    const hasData = monthlyTotals[m] !== undefined;
    const prevTotal = m > 0 ? (monthlyTotals[m-1] || DEBT_START) : DEBT_START;
    const reduction = hasData ? prevTotal - monthlyTotals[m] : null;
    const shortLabel = `${SHORT_MONTHS[m]}`;
    gridHtml += `
      <div class="debt-month-dot ${hasData ? 'has-data' : ''}">
        <div class="dot-label">${shortLabel}</div>
        ${hasData && reduction !== null ? `<div class="dot-val">-Â£${Math.round(reduction)}</div>` : '<div class="dot-val" style="opacity:0.3">â€”</div>'}
      </div>`;
  }
  document.getElementById('debt-monthly-grid').innerHTML = gridHtml;

  // Item list
  let itemHtml = '';
  DEBT_LIST.forEach(d => {
    const val = balances[d.id] !== undefined ? balances[d.id] : '';
    const displayOpening = `Opening: Â£${d.opening.toLocaleString('en-GB', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
    itemHtml += `
      <div class="debt-item">
        <div class="debt-item-info">
          <div class="debt-item-name">${d.name}</div>
          <div class="debt-item-balance">${displayOpening}</div>
        </div>
        <input class="debt-item-input" type="number" inputmode="decimal" 
               placeholder="Â£ now"
               value="${val}"
               onchange="saveDebt('${d.id}', this.value)"
               onblur="saveDebt('${d.id}', this.value)">
      </div>`;
  });
  document.getElementById('debt-items-list').innerHTML = itemHtml;

  // Overview debt bar
  const paid = DEBT_START - currentTotal;
  const pct = Math.max(0, Math.min(100, (paid / DEBT_START) * 100));
  document.getElementById('ov-debt-bar').style.width = pct + '%';
  document.getElementById('ov-debt-total').textContent = `Â£${currentTotal.toLocaleString('en-GB', {maximumFractionDigits: 0})}`;
  document.getElementById('ov-debt-paid').textContent = `Â£${Math.max(0, paid).toLocaleString('en-GB', {maximumFractionDigits: 0})} paid`;
  const etaMonths = Math.ceil(currentTotal / monthlyPay);
  document.getElementById('ov-debt-eta').textContent = `At Â£1,000/month â€” debt free in approx. ${etaMonths} months (${getPayoffDate(etaMonths)})`;
}

function saveDebt(id, val) {
  const balances = load(getKey('debt'), {});
  balances[id] = val === '' ? '' : parseFloat(val) || 0;
  save(getKey('debt'), balances);
  renderDebt();
  renderOverview();
}

function getPayoffDate(months) {
  const d = new Date();
  d.setMonth(d.getMonth() + months);
  return d.toLocaleDateString('en-GB', { month: 'long', year: 'numeric' });
}

// â”€â”€ OVERVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateOverviewDD(statuses) {
  const allDD    = getAllDD();
  const overrides = load(getKey('dd_amounts'), {});
  const confirmed = allDD.filter(d => (statuses[d.id] || '') === 'confirmed');
  const confirmedAmount = confirmed.reduce((s, d) => {
    const amt = overrides[d.id] !== undefined ? overrides[d.id] : d.amount;
    return s + parseFloat(amt);
  }, 0);
  const total = allDD.length;
  const pct   = (confirmed.length / total) * 100;

  document.getElementById('ov-dd-count').textContent  = `${confirmed.length} of ${total} confirmed`;
  document.getElementById('ov-dd-amount').textContent = `Â£${confirmedAmount.toFixed(0)} confirmed`;
  document.getElementById('ov-dd-bar').style.width    = pct + '%';
}

function updateOverviewVariable(actuals) {
  let html = '';
  VAR_LIST.forEach(v => {
    const actual = actuals[v.id] !== undefined && actuals[v.id] !== '' ? parseFloat(actuals[v.id]) : null;
    const diff = actual !== null ? v.budget - actual : null;
    html += `
      <div style="display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--paper2);">
        <span style="font-size:13px;">${v.emoji} ${v.name}</span>
        <span style="font-family:'DM Serif Display',serif;font-size:15px;color:${diff === null ? 'var(--ink3)' : diff < 0 ? 'var(--red)' : 'var(--green)'}">
          ${actual !== null ? `Â£${actual.toFixed(0)}` : 'â€”'}
        </span>
      </div>`;
  });
  document.getElementById('ov-variable-list').innerHTML = html;
}

function renderOverview() {
  const statuses  = load(getKey('dd'), {});
  const actuals   = load(getKey('var'), {});
  const overrides = load(getKey('dd_amounts'), {});
  const allDD     = getAllDD();

  const ddConfirmedTotal = allDD
    .filter(d => (statuses[d.id]||'') === 'confirmed')
    .reduce((s, d) => {
      const amt = overrides[d.id] !== undefined ? overrides[d.id] : d.amount;
      return s + parseFloat(amt);
    }, 0);
  const varTotal = VAR_LIST.reduce((s, v) => {
    const a = actuals[v.id];
    return s + (a !== undefined && a !== '' ? parseFloat(a) : 0);
  }, 0);

  const totalOut = ddConfirmedTotal + varTotal;
  const remaining = INCOME - totalOut;

  document.getElementById('ov-income').textContent = `Â£${INCOME.toLocaleString('en-GB')}`;
  document.getElementById('ov-out').textContent = totalOut > 0 ? `Â£${totalOut.toFixed(0)}` : 'â€”';
  document.getElementById('ov-remaining').textContent = totalOut > 0 ? `Â£${remaining.toFixed(0)}` : 'â€”';

  const tile = document.getElementById('ov-remaining-tile');
  tile.classList.remove('positive', 'negative');
  if (totalOut > 0) tile.classList.add(remaining >= 0 ? 'positive' : 'negative');

  updateOverviewDD(statuses);
  updateOverviewVariable(actuals);
}

// â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}

// â”€â”€ LONG PRESS (iOS fix) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let pressTimer;
document.addEventListener('touchstart', function(e) {
  const dd = e.target.closest('.dd-item');
  if (!dd) return;
  const id = dd.id.replace('dd-', '');
  pressTimer = setTimeout(() => openCtxMenu(e, id), 500);
}, { passive: true });

document.addEventListener('touchend', () => clearTimeout(pressTimer), { passive: true });
document.addEventListener('touchmove', () => clearTimeout(pressTimer), { passive: true });

// â”€â”€ START â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
init();
</script>

</body>
</html>
