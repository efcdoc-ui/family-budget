<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>O'Connor Family Budget</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://js.puter.com/v2/"></script>
    <style>
        :root {
            --ink: #0f1923;
            --ink2: #2a3a4a;
            --ink3: #5a6a7a;
            --paper: #f5f0e8;
            --paper2: #ede8dc;
            --paper3: #e0d9cc;
            --green: #2d6a4f;
            --green-l: #d8f3dc;
            --green-m: #74c69d;
            --red: #c1121f;
            --red-l: #fce4e4;
            --amber: #e76f00;
            --amber-l: #fff3e0;
            --blue: #1a4a8a;
            --blue-l: #e8f0fb;
            --accent: #c9a84c;
            --card: #ffffff;
            --shadow: 0 2px 12px rgba(15,25,35,0.08);
            --shadow-lg: 0 8px 32px rgba(15,25,35,0.12);
            --r: 14px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--paper);
            color: var(--ink);
            min-height: 100vh;
            padding-bottom: 90px;
        }

        /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
        .header {
            background: var(--ink);
            padding: 20px 20px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .logo {
            font-family: 'DM Serif Display', serif;
            font-size: 22px;
            color: var(--accent);
            letter-spacing: -0.5px;
        }

        .month-select {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            font-family: 'DM Sans', sans-serif;
            font-size: 13px;
            font-weight: 500;
            padding: 6px 12px;
            border-radius: 20px;
            outline: none;
            cursor: pointer;
        }

        .period-label {
            font-size: 11px;
            color: rgba(255,255,255,0.45);
            margin-bottom: 10px;
            margin-top: -10px;
            letter-spacing: 0.3px;
        }

        .sync-status {
            font-size: 10px;
            color: var(--green-m);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .nav-tabs {
            display: flex;
            gap: 0;
            overflow-x: auto;
            scrollbar-width: none;
        }
        .nav-tabs::-webkit-scrollbar { display: none; }

        .tab {
            flex: 0 0 auto;
            padding: 10px 18px;
            font-size: 13px;
            font-weight: 500;
            color: rgba(255,255,255,0.5);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .tab.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }

        /* ‚îÄ‚îÄ CONTENT ‚îÄ‚îÄ */
        .content { padding: 16px; display: none; }
        .content.active { display: block; }

        /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
        .card {
            background: var(--card);
            border-radius: var(--r);
            box-shadow: var(--shadow);
            padding: 16px;
            margin-bottom: 12px;
        }

        .card-title {
            font-family: 'DM Serif Display', serif;
            font-size: 16px;
            color: var(--ink);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-title span { font-size: 18px; }

        /* ‚îÄ‚îÄ SUMMARY STRIP ‚îÄ‚îÄ */
        .summary-strip {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 16px;
        }

        .summary-tile {
            background: var(--card);
            border-radius: var(--r);
            padding: 14px 10px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .summary-tile .label {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--ink3);
            margin-bottom: 4px;
        }

        .summary-tile .amount {
            font-family: 'DM Serif Display', serif;
            font-size: 18px;
            font-weight: 400;
        }

        .tile-income .amount { color: var(--green); }
        .tile-out .amount { color: var(--red); }
        .tile-remaining .amount { color: var(--blue); }
        .tile-remaining.positive .amount { color: var(--green); }
        .tile-remaining.negative .amount { color: var(--red); }

        /* ‚îÄ‚îÄ DD CHECKLIST ‚îÄ‚îÄ */
        .dd-section-label {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--ink3);
            padding: 10px 0 6px;
        }

        .dd-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 11px 14px;
            border-radius: 10px;
            margin-bottom: 6px;
            background: var(--paper);
            transition: all 0.25s;
            cursor: pointer;
            border: 1.5px solid transparent;
        }

        .dd-item.confirmed {
            background: var(--green-l);
            border-color: var(--green-m);
        }

        .dd-item.issue {
            background: var(--red-l);
            border-color: var(--red);
        }

        .dd-check {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            border: 2px solid var(--paper3);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 13px;
            transition: all 0.2s;
            background: white;
        }

        .dd-item.confirmed .dd-check {
            background: var(--green);
            border-color: var(--green);
            color: white;
        }

        .dd-item.issue .dd-check {
            background: var(--red);
            border-color: var(--red);
            color: white;
        }

        .dd-info { flex: 1; min-width: 0; }

        .dd-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--ink);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dd-item.confirmed .dd-name { color: var(--green); }

        .dd-due {
            font-size: 11px;
            color: var(--ink3);
            margin-top: 1px;
        }

        .dd-amount {
            font-family: 'DM Serif Display', serif;
            font-size: 16px;
            color: var(--ink);
            flex-shrink: 0;
        }

        .dd-item.confirmed .dd-amount { color: var(--green); }

        /* Long press menu */
        .ctx-menu {
            display: none;
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--ink);
            border-radius: 14px;
            padding: 6px;
            z-index: 999;
            box-shadow: var(--shadow-lg);
            min-width: 200px;
        }

        .ctx-menu.show { display: block; }

        .ctx-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            color: white;
            font-size: 14px;
            font-weight: 500;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .ctx-option:hover { background: rgba(255,255,255,0.1); }
        .ctx-option .icon { font-size: 18px; width: 24px; text-align: center; }
        .ctx-option.green { color: var(--green-m); }
        .ctx-option.red { color: #ff6b6b; }
        .ctx-option.amber { color: var(--accent); }

        .ctx-overlay {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 998;
        }
        .ctx-overlay.show { display: block; }

        /* ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ */
        .progress-wrap { margin-top: 8px; }

        .progress-bar-bg {
            height: 8px;
            background: var(--paper2);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            background: var(--green);
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--ink3);
            margin-top: 4px;
        }

        /* ‚îÄ‚îÄ VARIABLE SPEND ‚îÄ‚îÄ */
        .var-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid var(--paper2);
        }

        .var-item:last-child { border-bottom: none; }

        .var-emoji { font-size: 20px; width: 32px; text-align: center; flex-shrink: 0; }

        .var-info { flex: 1; }

        .var-name { font-size: 14px; font-weight: 500; }

        .var-budget { font-size: 11px; color: var(--ink3); margin-top: 1px; }

        .var-input-wrap { display: flex; flex-direction: column; align-items: flex-end; gap: 2px; }

        .var-input {
            width: 90px;
            text-align: right;
            border: 1.5px solid var(--paper3);
            border-radius: 8px;
            padding: 6px 10px;
            font-family: 'DM Serif Display', serif;
            font-size: 16px;
            color: var(--ink);
            background: var(--paper);
            outline: none;
            transition: border-color 0.2s;
        }

        .var-input:focus { border-color: var(--blue); background: white; }

        .var-diff {
            font-size: 11px;
            font-weight: 600;
        }

        .var-diff.over { color: var(--red); }
        .var-diff.under { color: var(--green); }

        /* ‚îÄ‚îÄ DEBT TRACKER ‚îÄ‚îÄ */
        .debt-total-hero {
            background: linear-gradient(135deg, var(--ink) 0%, var(--ink2) 100%);
            border-radius: var(--r);
            padding: 20px;
            margin-bottom: 12px;
            position: relative;
            overflow: hidden;
        }

        .debt-total-hero::before {
            content: '';
            position: absolute;
            right: -20px;
            top: -20px;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: rgba(201,168,76,0.15);
        }

        .debt-hero-label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255,255,255,0.5);
            margin-bottom: 4px;
        }

        .debt-hero-amount {
            font-family: 'DM Serif Display', serif;
            font-size: 38px;
            color: white;
            letter-spacing: -1px;
        }

        .debt-hero-sub {
            font-size: 12px;
            color: rgba(255,255,255,0.5);
            margin-top: 6px;
        }

        .debt-hero-sub strong {
            color: var(--green-m);
        }

        .debt-monthly-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 4px;
            margin-top: 14px;
        }

        .debt-month-dot {
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 5px 2px;
            text-align: center;
        }

        .debt-month-dot.has-data {
            background: rgba(116,198,157,0.25);
        }

        .debt-month-dot .dot-label {
            font-size: 9px;
            color: rgba(255,255,255,0.5);
            font-weight: 600;
        }

        .debt-month-dot .dot-val {
            font-size: 10px;
            color: var(--green-m);
            font-weight: 600;
            margin-top: 2px;
        }

        .debt-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--paper2);
            gap: 12px;
        }

        .debt-item:last-child { border-bottom: none; }

        .debt-item-info { flex: 1; }

        .debt-item-name { font-size: 14px; font-weight: 500; }

        .debt-item-balance { font-size: 11px; color: var(--ink3); margin-top: 2px; }

        .debt-item-input {
            width: 100px;
            text-align: right;
            border: 1.5px solid var(--paper3);
            border-radius: 8px;
            padding: 6px 10px;
            font-family: 'DM Serif Display', serif;
            font-size: 15px;
            color: var(--ink);
            background: var(--paper);
            outline: none;
            transition: border-color 0.2s;
        }

        .debt-item-input:focus { border-color: var(--blue); background: white; }

        /* ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid var(--paper2);
            display: flex;
            padding: 8px 0 20px;
            z-index: 100;
            box-shadow: 0 -4px 20px rgba(15,25,35,0.08);
        }

        .nav-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            padding: 6px 0;
            cursor: pointer;
            color: var(--ink3);
            transition: color 0.2s;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-btn .nav-icon { font-size: 22px; }
        .nav-btn.active { color: var(--blue); }

        /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
        .toast {
            position: fixed;
            top: -60px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--ink);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            transition: top 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 9999;
            white-space: nowrap;
        }

        .toast.show { top: 80px; }

        /* ‚îÄ‚îÄ MISC ‚îÄ‚îÄ */
        .section-divider {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 16px 0 8px;
        }

        .section-divider-line { flex: 1; height: 1px; background: var(--paper2); }

        .section-divider-label {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--ink3);
        }

        .badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: var(--green);
            color: white;
            font-size: 10px;
            font-weight: 700;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            margin-left: auto;
        }

        .badge.amber { background: var(--amber); }

        .all-done-banner {
            background: linear-gradient(135deg, var(--green) 0%, #40916c 100%);
            border-radius: var(--r);
            padding: 16px;
            color: white;
            text-align: center;
            margin-bottom: 12px;
        }

        .all-done-banner .big { font-family: 'DM Serif Display', serif; font-size: 22px; }
        .all-done-banner .sub { font-size: 12px; opacity: 0.8; margin-top: 4px; }

        /* ‚îÄ‚îÄ EDIT MODAL ‚îÄ‚îÄ */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(15,25,35,0.6);
            z-index: 500;
            backdrop-filter: blur(2px);
        }
        .modal-overlay.show { display: flex; align-items: flex-end; }

        .modal {
            background: white;
            border-radius: 20px 20px 0 0;
            padding: 24px 20px 40px;
            width: 100%;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.34,1.2,0.64,1);
        }
        .modal-overlay.show .modal { transform: translateY(0); }

        .modal-handle {
            width: 36px;
            height: 4px;
            background: var(--paper3);
            border-radius: 2px;
            margin: 0 auto 20px;
        }

        .modal-title {
            font-family: 'DM Serif Display', serif;
            font-size: 20px;
            margin-bottom: 16px;
        }

        .modal-field { margin-bottom: 14px; }

        .modal-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--ink3);
            margin-bottom: 6px;
        }

        .modal-input {
            width: 100%;
            padding: 12px 14px;
            border: 1.5px solid var(--paper3);
            border-radius: 10px;
            font-family: 'DM Sans', sans-serif;
            font-size: 16px;
            color: var(--ink);
            background: var(--paper);
            outline: none;
            transition: border-color 0.2s;
        }
        .modal-input:focus { border-color: var(--blue); background: white; }

        .modal-btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-family: 'DM Sans', sans-serif;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 6px;
            transition: opacity 0.15s;
        }
        .modal-btn:active { opacity: 0.8; }
        .modal-btn-primary { background: var(--ink); color: white; }
        .modal-btn-danger  { background: var(--red-l); color: var(--red); margin-top: 8px; }
        .modal-btn-cancel  { background: var(--paper2); color: var(--ink3); margin-top: 8px; }

        /* ‚îÄ‚îÄ ADD DD BUTTON ‚îÄ‚îÄ */
        .add-dd-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 12px;
            margin-top: 8px;
            background: var(--blue-l);
            border: 1.5px dashed var(--blue);
            border-radius: 10px;
            color: var(--blue);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.15s;
        }
        .add-dd-btn:active { background: #d0e4f7; }

        /* edit pencil on DD amount */
        .dd-amount-wrap {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            flex-shrink: 0;
        }
        .dd-edit-hint {
            font-size: 9px;
            color: var(--ink3);
            margin-top: 2px;
            opacity: 0.7;
        }

    </style>
</head>
<body>

<div class="header">
  <div class="header-top">
    <div class="logo">O'Connor Budget</div>
    <select class="month-select" id="monthSelect" onchange="changeMonth(this.value)">
      <option value="0">24 Jan ‚Äì 23 Feb</option>
      <option value="1">24 Feb ‚Äì 23 Mar</option>
      <option value="2">24 Mar ‚Äì 23 Apr</option>
      <option value="3">24 Apr ‚Äì 23 May</option>
      <option value="4">24 May ‚Äì 23 Jun</option>
      <option value="5">24 Jun ‚Äì 23 Jul</option>
      <option value="6">24 Jul ‚Äì 23 Aug</option>
      <option value="7">24 Aug ‚Äì 23 Sep</option>
      <option value="8">24 Sep ‚Äì 23 Oct</option>
      <option value="9">24 Oct ‚Äì 23 Nov</option>
      <option value="10">24 Nov ‚Äì 23 Dec</option>
      <option value="11">24 Dec ‚Äì 23 Jan</option>
    </select>
  </div>
  <div class="sync-status" id="syncStatus">
      <span>‚óè</span> Cloud Connected
      <button onclick="init()" style="background:none; border:none; color:var(--accent); font-size:10px; text-decoration:underline; margin-left:10px; cursor:pointer;">Refresh Sync</button>
  </div>
  <div class="nav-tabs">
    <div class="tab active" onclick="showTab('overview')">Overview</div>
    <div class="tab" onclick="showTab('checklist')">Direct Debits</div>
    <div class="tab" onclick="showTab('variable')">Variable</div>
    <div class="tab" onclick="showTab('debt')">Debt</div>
  </div>
  <div class="period-label" id="periodLabel"></div>
</div>

<div class="ctx-overlay" id="ctxOverlay" onclick="closeCtxMenu()"></div>
<div class="ctx-menu" id="ctxMenu">
  <div class="ctx-option green" onclick="setDDStatus('confirmed')">
    <span class="icon">‚úì</span> Confirmed out
  </div>
  <div class="ctx-option amber" onclick="setDDStatus('check')">
    <span class="icon">?</span> Need to check
  </div>
  <div class="ctx-option red" onclick="setDDStatus('issue')">
    <span class="icon">‚úó</span> Issue / problem
  </div>
  <div class="ctx-option" onclick="openEditModal(ctxId); closeCtxMenu();">
    <span class="icon">‚úèÔ∏è</span> Edit amount / name
  </div>
  <div class="ctx-option red" onclick="deleteDD(ctxId); closeCtxMenu();" id="ctx-delete-btn">
    <span class="icon">üóë</span> Delete
  </div>
  <div class="ctx-option" onclick="setDDStatus('')">
    <span class="icon">‚óã</span> Reset status
  </div>
</div>

<div class="modal-overlay" id="editModal" onclick="closeEditModal(event)">
    <div class="modal">
      <div class="modal-handle"></div>
      <div class="modal-title" id="editModalTitle">Edit Direct Debit</div>
      <div class="modal-field">
        <div class="modal-label">Name</div>
        <input class="modal-input" id="editName" type="text">
      </div>
      <div class="modal-field">
        <div class="modal-label">Amount ¬£</div>
        <input class="modal-input" id="editAmount" type="number" inputmode="decimal">
      </div>
      <div class="modal-field">
        <div class="modal-label">Due date</div>
        <input class="modal-input" id="editDue" type="text">
      </div>
      <div class="modal-field">
        <div class="modal-label">Section</div>
        <select class="modal-input" id="editSection">
          <option>Home</option><option>Transport</option><option>Insurance</option><option>Debt</option><option>Savings</option><option>Other</option>
        </select>
      </div>
      <button class="modal-btn modal-btn-primary" onclick="saveEditModal()">Save changes</button>
      <button class="modal-btn modal-btn-cancel" onclick="closeEditModal()">Cancel</button>
    </div>
  </div>

<div class="modal-overlay" id="addModal" onclick="closeAddModal(event)">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">Add Direct Debit</div>
    <div class="modal-field">
      <div class="modal-label">Name</div>
      <input class="modal-input" id="addName" type="text">
    </div>
    <div class="modal-field">
      <div class="modal-label">Amount ¬£</div>
      <input class="modal-input" id="addAmount" type="number" inputmode="decimal">
    </div>
    <div class="modal-field">
      <div class="modal-label">Due date</div>
      <input class="modal-input" id="addDue" type="text">
    </div>
    <div class="modal-field">
        <div class="modal-label">Section</div>
        <select class="modal-input" id="addSection">
          <option>Home</option><option>Transport</option><option>Insurance</option><option>Debt</option><option>Savings</option><option>Other</option>
        </select>
    </div>
    <button class="modal-btn modal-btn-primary" onclick="saveAddModal()">Add payment</button>
    <button class="modal-btn modal-btn-cancel" onclick="closeAddModal()">Cancel</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<div class="content active" id="tab-overview">
  <div class="summary-strip">
    <div class="summary-tile tile-income">
      <div class="label">Income</div>
      <div class="amount" id="ov-income">¬£5,583</div>
    </div>
    <div class="summary-tile tile-out">
      <div class="label">Out</div>
      <div class="amount" id="ov-out">‚Äî</div>
    </div>
    <div class="summary-tile tile-remaining" id="ov-remaining-tile">
      <div class="label">Left</div>
      <div class="amount" id="ov-remaining">‚Äî</div>
    </div>
  </div>
  <div class="card">
    <div class="card-title"><span>üìã</span> Direct Debits</div>
    <div class="progress-wrap">
      <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:6px;">
        <span id="ov-dd-count" style="color:var(--ink3)">0 of 0 confirmed</span>
        <span id="ov-dd-amount" style="font-weight:600;color:var(--green)">¬£0</span>
      </div>
      <div class="progress-bar-bg"><div class="progress-bar-fill" id="ov-dd-bar" style="width:0%"></div></div>
    </div>
  </div>
  <div class="card"><div class="card-title"><span>üõí</span> Variable Spend</div><div id="ov-variable-list"></div></div>
  <div class="card">
    <div class="card-title"><span>üí≥</span> Debt Progress</div>
    <div style="display:flex;justify-content:space-between;align-items:baseline;margin-bottom:8px;">
      <span style="font-size:13px;color:var(--ink3)">Total remaining</span>
      <span style="font-family:'DM Serif Display',serif;font-size:22px;" id="ov-debt-total">¬£0</span>
    </div>
    <div class="progress-wrap">
      <div class="progress-bar-bg"><div class="progress-bar-fill" id="ov-debt-bar" style="width:0%;background:var(--accent)"></div></div>
      <div class="progress-label"><span id="ov-debt-paid">¬£0 paid</span><span>¬£21,884 start</span></div>
    </div>
    <div style="margin-top:10px;font-size:12px;color:var(--ink3)" id="ov-debt-eta"></div>
  </div>
</div>

<div class="content" id="tab-checklist"><div id="checklist-all-done" style="display:none"><div class="all-done-banner"><div class="big">üéâ All done!</div><div class="sub">Every direct debit confirmed this month</div></div></div><div id="checklist-body"></div></div>
<div class="content" id="tab-variable"><div class="card"><div class="card-title"><span>üõí</span> Variable Spend</div><div id="var-items-list"></div><div style="border-top:2px solid var(--paper2);margin-top:12px;padding-top:12px;display:flex;justify-content:space-between;align-items:center;"><span style="font-size:13px;font-weight:600;">Total</span><div style="text-align:right;"><div style="font-family:'DM Serif Display',serif;font-size:20px;" id="var-total-actual">¬£0</div><div style="font-size:11px;color:var(--ink3)">Budget: <span id="var-total-budget">¬£1,165</span></div></div></div></div></div>
<div class="content" id="tab-debt"><div class="debt-total-hero"><div class="debt-hero-label">Total Debt Remaining</div><div class="debt-hero-amount" id="debt-hero-amount">¬£0</div><div class="debt-hero-sub">Paying approx. <strong>¬£1,000/month</strong> ¬∑ <span id="debt-eta-hero">...</span></div><div class="debt-monthly-grid" id="debt-monthly-grid"></div></div><div class="card"><div class="card-title"><span>üìù</span> Update balances</div><div id="debt-items-list"></div></div></div>

<script>
// ‚îÄ‚îÄ PUTER CLOUD LOGIC ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const BUDGET_FILE = 'oconnor_family_budget.json';
window.currentCloudData = {};

async function save(key, val) {
    window.currentCloudData[key] = val;
    try {
        await puter.fs.write(BUDGET_FILE, JSON.stringify(window.currentCloudData));
        console.log("Cloud Saved:", key);
    } catch (e) {
        console.error("Cloud Save Error:", e);
        showToast("‚ö†Ô∏è Cloud save failed!");
    }
}

function load(key, def) {
    return window.currentCloudData[key] !== undefined ? window.currentCloudData[key] : def;
}

// ‚îÄ‚îÄ DATA & CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const MONTHS = ['January','February','March','April','May','June','July','August','September','October','November','December'];
const SHORT_MONTHS = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
const INCOME = 5583;
const DD_LIST = [
  { id: 'mortgage',    name: 'Mortgage / Rent',       amount: 812.37, due: '1st',  section: 'Home' },
  { id: 'council',     name: 'Council Tax',            amount: 185.00, due: '1st',  section: 'Home' },
  { id: 'electricity', name: 'Electricity',            amount: 104.00, due: '3rd',  section: 'Home' },
  { id: 'gas',         name: 'Gas / Oil',              amount: 104.00, due: '3rd',  section: 'Home' },
  { id: 'water',       name: 'Water',                  amount:  95.00, due: '5th',  section: 'Home' },
  { id: 'internet',    name: 'Internet',               amount:  30.00, due: '5th',  section: 'Home' },
  { id: 'phone',       name: 'Phone',                  amount:  21.00, due: '7th',  section: 'Home' },
  { id: 'tvlicence',   name: 'TV Licence',             amount:  15.00, due: '7th',  section: 'Home' },
  { id: 'homeins',     name: 'Home Insurance',         amount:  20.00, due: '8th',  section: 'Home' },
  { id: 'carpay',      name: 'Car Payment',            amount: 380.00, due: '1st',  section: 'Transport' },
  { id: 'autoins',     name: 'Auto Insurance',         amount:  59.00, due: '10th', section: 'Transport' },
  { id: 'gapins',      name: 'Gap Insurance',          amount:  14.14, due: '10th', section: 'Transport' },
  { id: 'lifeins',     name: 'Life Insurance',         amount:   9.89, due: '12th', section: 'Insurance' },
  { id: 'healthins',   name: 'Health Insurance',       amount:  20.00, due: '12th', section: 'Insurance' },
  { id: 'union',       name: 'Union',                  amount:   4.24, due: '15th', section: 'Other' },
  { id: 'kidsclubs',   name: 'Kids Clubs',             amount:  25.00, due: '15th', section: 'Other' },
  { id: 'nursery',     name: 'Nursery',                amount: 130.00, due: '15th', section: 'Other' },
  { id: 'barclaycard', name: 'Barclaycard (min)',      amount: 150.00, due: '18th', section: 'Debt' },
  { id: 'hsbc',        name: 'HSBC (min)',             amount: 407.82, due: '18th', section: 'Debt' },
  { id: 'paypal',      name: 'PayPal (min)',           amount: 100.00, due: '20th', section: 'Debt' },
  { id: 'lloyds',      name: 'Lloyds (min)',           amount: 313.86, due: '20th', section: 'Debt' },
  { id: 'extradebt',   name: 'Additional Debt',        amount:  28.32, due: '22nd', section: 'Debt' },
  { id: 'carloan',     name: 'Car Loan',               amount: 270.00, due: '1st',  section: 'Transport' },
  { id: 'savings',     name: 'Savings Transfer',       amount: 100.00, due: '25th', section: 'Savings' },
];
const VAR_LIST = [
  { id: 'groceries', name: 'Groceries', emoji: 'üõí', budget: 800 },
  { id: 'fuel',      name: 'Fuel',      emoji: '‚õΩ', budget: 123 },
  { id: 'tunnel',    name: 'Tunnel',    emoji: 'üöó', budget:  10 },
  { id: 'vet',       name: 'Vet / Pet', emoji: 'üêæ', budget:  31 },
  { id: 'medicine',  name: 'Medicine',  emoji: 'üíä', budget:  11 },
  { id: 'other',     name: 'Other',     emoji: 'üì¶', budget:   0 },
];
const DEBT_LIST = [
  { id: 'debt_barclaycard', name: 'Barclaycard', opening: 10700 },
  { id: 'debt_amex',        name: 'Amex',         opening:  4750 },
  { id: 'debt_halifax',     name: 'Halifax',      opening:  9118.56 },
  { id: 'debt_paypal',      name: 'PayPal',       opening:  2080.47 },
  { id: 'debt_overdraft',   name: 'Dan Overdraft',opening:  2300 },
  { id: 'debt_school',      name: 'School Fees',  opening:   600 },
  { id: 'debt_very',        name: 'Very',         opening:   253.98 },
  { id: 'debt_hsbc',        name: 'HSBC',         opening:     0 },
  { id: 'debt_lloyds',      name: 'Lloyds',       opening:     0 },
];
const DEBT_START = 21884.45;

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let currentMonth = getCurrentPeriod();
let activeTab = 'overview';
let ctxId = null;

function getCurrentPeriod() {
  const now = new Date();
  const day = now.getDate();
  const m = now.getMonth();
  return day >= 24 ? m : (m === 0 ? 11 : m - 1);
}

function getPeriodDates(periodIdx) {
  const startMonth = MONTHS[periodIdx];
  const endMonthIdx = (periodIdx + 1) % 12;
  const endMonth = MONTHS[endMonthIdx];
  return `24 ${startMonth} ‚Äì 23 ${endMonth}`;
}

function getKey(suffix) { return `ocb_${currentMonth}_${suffix}`; }

// ‚îÄ‚îÄ INITIALIZATION (UPDATED FOR CLOUD) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function init() {
    showToast("Syncing with cloud...");
    document.getElementById('syncStatus').innerHTML = "<span>‚óè</span> Syncing...";
    
    try {
        const file = await puter.fs.read(BUDGET_FILE);
        const text = await file.text();
        window.currentCloudData = JSON.parse(text);
        document.getElementById('syncStatus').innerHTML = "<span>‚óè</span> Cloud Connected <button onclick='init()' style='background:none; border:none; color:var(--accent); font-size:10px; text-decoration:underline; margin-left:10px; cursor:pointer;'>Refresh</button>";
    } catch (e) {
        console.log("No existing budget file found, starting fresh.");
        window.currentCloudData = {};
        document.getElementById('syncStatus').innerHTML = "<span>‚óè</span> Cloud Ready (New)";
    }

    updatePeriodLabel();
    renderChecklist();
    renderVariable();
    renderDebt();
    renderOverview();
    showToast("Cloud Sync Ready");
}

function updatePeriodLabel() {
  document.getElementById('periodLabel').textContent = getPeriodDates(currentMonth);
  document.getElementById('monthSelect').value = currentMonth;
}

function changeMonth(val) {
  currentMonth = parseInt(val);
  updatePeriodLabel();
  renderChecklist();
  renderVariable();
  renderDebt();
  renderOverview();
}

// ‚îÄ‚îÄ TAB SWITCHING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showTab(tab) {
  activeTab = tab;
  document.querySelectorAll('.content').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
  document.getElementById('tab-' + tab).classList.add('active');
  const tabMap = { overview: 0, checklist: 1, variable: 2, debt: 3 };
  document.querySelectorAll('.tab')[tabMap[tab]].classList.add('active');
}

// ‚îÄ‚îÄ CHECKLIST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getAllDD() {
  const custom = load('ocb_custom_dd', []);
  return [...DD_LIST, ...custom];
}

function renderChecklist() {
  const statuses   = load(getKey('dd'), {});
  const overrides  = load(getKey('dd_amounts'), {});
  const allDD      = getAllDD();
  const body       = document.getElementById('checklist-body');
  const sections   = [...new Set(allDD.map(d => d.section))];

  let html = '';
  sections.forEach(sec => {
    const items = allDD.filter(d => d.section === sec);
    html += `<div class="dd-section-label">${sec}</div>`;
    items.forEach(dd => {
      const status  = statuses[dd.id] || '';
      const amount  = overrides[dd.id] !== undefined ? overrides[dd.id] : dd.amount;
      const cls     = status === 'confirmed' ? 'confirmed' : status === 'issue' ? 'issue' : '';
      const chk     = status === 'confirmed' ? '‚úì' : status === 'issue' ? '‚úó' : status === 'check' ? '?' : '';
      html += `
        <div class="dd-item ${cls}" id="dd-${dd.id}" onclick="tapDD('${dd.id}')" oncontextmenu="openCtxMenu(event,'${dd.id}'); return false;">
          <div class="dd-check">${chk}</div>
          <div class="dd-info"><div class="dd-name">${dd.name}</div><div class="dd-due">Due ~${dd.due}</div></div>
          <div class="dd-amount-wrap"><div class="dd-amount">¬£${parseFloat(amount).toFixed(2)}</div><div class="dd-edit-hint">hold to edit</div></div>
        </div>`;
    });
  });

  html += `<div class="add-dd-btn" onclick="openAddModal()">Ôºã Add a payment</div>`;
  body.innerHTML = html;
  updateOverviewDD(statuses);
}

function tapDD(id) {
  const statuses = load(getKey('dd'), {});
  statuses[id] = (statuses[id] === 'confirmed') ? '' : 'confirmed';
  save(getKey('dd'), statuses);
  renderChecklist();
  renderOverview();
  if (statuses[id] === 'confirmed') showToast('‚úì Confirmed');
}

function openCtxMenu(e, id) {
  e.preventDefault(); ctxId = id;
  const isCustom = load('ocb_custom_dd', []).some(d => d.id === id);
  document.getElementById('ctx-delete-btn').style.display = isCustom ? 'flex' : 'none';
  document.getElementById('ctxMenu').classList.add('show');
  document.getElementById('ctxOverlay').classList.add('show');
}

function closeCtxMenu() {
  document.getElementById('ctxMenu').classList.remove('show');
  document.getElementById('ctxOverlay').classList.remove('show');
}

function setDDStatus(status) {
  if (!ctxId) return;
  const statuses = load(getKey('dd'), {});
  statuses[ctxId] = status;
  save(getKey('dd'), statuses);
  closeCtxMenu();
  renderChecklist();
  renderOverview();
}

// ‚îÄ‚îÄ MODALS & ADD/EDIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openAddModal() { document.getElementById('addModal').classList.add('show'); }
function closeAddModal() { document.getElementById('addModal').classList.remove('show'); }
function saveAddModal() {
    const name = document.getElementById('addName').value;
    const amount = document.getElementById('addAmount').value;
    if(!name || !amount) return;
    const custom = load('ocb_custom_dd', []);
    custom.push({ id: 'c'+Date.now(), name, amount, section: document.getElementById('addSection').value, due: document.getElementById('addDue').value });
    save('ocb_custom_dd', custom);
    closeAddModal();
    renderChecklist();
    renderOverview();
}

function openEditModal(id) {
    ctxId = id;
    const all = getAllDD();
    const item = all.find(d => d.id === id);
    document.getElementById('editName').value = item.name;
    document.getElementById('editAmount').value = item.amount;
    document.getElementById('editModal').classList.add('show');
}
function closeEditModal() { document.getElementById('editModal').classList.remove('show'); }
function saveEditModal() {
    const amt = parseFloat(document.getElementById('editAmount').value);
    const overrides = load(getKey('dd_amounts'), {});
    overrides[ctxId] = amt;
    save(getKey('dd_amounts'), overrides);
    closeEditModal();
    renderChecklist();
    renderOverview();
}

function deleteDD(id) {
  const custom = load('ocb_custom_dd', []);
  save('ocb_custom_dd', custom.filter(d => d.id !== id));
  renderChecklist(); renderOverview();
}

// ‚îÄ‚îÄ VARIABLE SPEND ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderVariable() {
  const actuals = load(getKey('var'), {});
  let html = ''; let totalActual = 0; let totalBudget = 0;
  VAR_LIST.forEach(v => {
    const act = actuals[v.id] || '';
    totalBudget += v.budget;
    if(act) totalActual += parseFloat(act);
    html += `<div class="var-item"><div class="var-emoji">${v.emoji}</div><div class="var-info"><div class="var-name">${v.name}</div><div class="var-budget">Budget: ¬£${v.budget}</div></div><div class="var-input-wrap"><input class="var-input" type="number" value="${act}" onchange="saveVar('${v.id}', this.value)"></div></div>`;
  });
  document.getElementById('var-items-list').innerHTML = html;
  document.getElementById('var-total-actual').textContent = `¬£${totalActual.toFixed(0)}`;
  updateOverviewVariable(actuals);
}

function saveVar(id, val) {
  const actuals = load(getKey('var'), {});
  actuals[id] = val;
  save(getKey('var'), actuals);
  renderVariable(); renderOverview();
}

// ‚îÄ‚îÄ DEBT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderDebt() {
  const balances = load(getKey('debt'), {});
  const currentTotal = DEBT_LIST.reduce((sum, d) => sum + (parseFloat(balances[d.id]) || d.opening), 0);
  document.getElementById('debt-hero-amount').textContent = `¬£${currentTotal.toLocaleString()}`;
  
  let itemHtml = '';
  DEBT_LIST.forEach(d => {
    const val = balances[d.id] || '';
    itemHtml += `<div class="debt-item"><div class="debt-item-info"><div class="debt-item-name">${d.name}</div><div class="debt-item-balance">Opening: ¬£${d.opening}</div></div><input class="debt-item-input" type="number" value="${val}" onchange="saveDebt('${d.id}', this.value)"></div>`;
  });
  document.getElementById('debt-items-list').innerHTML = itemHtml;
  
  // Overview progress
  const paid = DEBT_START - currentTotal;
  const pct = (paid / DEBT_START) * 100;
  document.getElementById('ov-debt-bar').style.width = pct + '%';
  document.getElementById('ov-debt-total').textContent = `¬£${currentTotal.toLocaleString()}`;
}

function saveDebt(id, val) {
  const balances = load(getKey('debt'), {});
  balances[id] = val;
  save(getKey('debt'), balances);
  renderDebt(); renderOverview();
}

// ‚îÄ‚îÄ OVERVIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateOverviewDD(statuses) {
  const all = getAllDD();
  const confirmed = all.filter(d => statuses[d.id] === 'confirmed');
  const pct = (confirmed.length / all.length) * 100;
  document.getElementById('ov-dd-bar').style.width = pct + '%';
  document.getElementById('ov-dd-count').textContent = `${confirmed.length} of ${all.length} confirmed`;
}

function updateOverviewVariable(actuals) {
  let html = '';
  VAR_LIST.forEach(v => {
    const act = actuals[v.id] ? `¬£${parseFloat(actuals[v.id]).toFixed(0)}` : '‚Äî';
    html += `<div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--paper2);"><span style="font-size:13px;">${v.emoji} ${v.name}</span><span style="font-family:'DM Serif Display',serif;font-size:15px;">${act}</span></div>`;
  });
  document.getElementById('ov-variable-list').innerHTML = html;
}

function renderOverview() {
  const statuses = load(getKey('dd'), {});
  const actuals = load(getKey('var'), {});
  const ddConfirmedTotal = getAllDD().filter(d => statuses[d.id] === 'confirmed').reduce((s, d) => s + d.amount, 0);
  const varTotal = VAR_LIST.reduce((s, v) => s + (parseFloat(actuals[v.id]) || 0), 0);
  const totalOut = ddConfirmedTotal + varTotal;
  const remaining = INCOME - totalOut;

  document.getElementById('ov-out').textContent = `¬£${totalOut.toFixed(0)}`;
  document.getElementById('ov-remaining').textContent = `¬£${remaining.toFixed(0)}`;
  const tile = document.getElementById('ov-remaining-tile');
  tile.className = 'summary-tile tile-remaining ' + (remaining >= 0 ? 'positive' : 'negative');
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}

// Start Puter Auth and Init
puter.ui.authenticate().then(init);

</script>
</body>
</html>
